{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@tohsakarat/save-and-load-draft-automatically/./src/forum/index.js","webpack://@tohsakarat/save-and-load-draft-automatically/external root \"flarum.core.compat['common/extend']\"","webpack://@tohsakarat/save-and-load-draft-automatically/external root \"flarum.core.compat['forum/app']\"","webpack://@tohsakarat/save-and-load-draft-automatically/external root \"flarum.core.compat['forum/components/CommentPost']\"","webpack://@tohsakarat/save-and-load-draft-automatically/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@tohsakarat/save-and-load-draft-automatically/external root \"flarum.core.compat['forum/components/PostStreamScrubber']\"","webpack://@tohsakarat/save-and-load-draft-automatically/external root \"flarum.core.compat['forum/resolvers/DiscussionPageResolver']\"","webpack://@tohsakarat/save-and-load-draft-automatically/webpack/bootstrap","webpack://@tohsakarat/save-and-load-draft-automatically/webpack/runtime/compat get default export","webpack://@tohsakarat/save-and-load-draft-automatically/webpack/runtime/define property getters","webpack://@tohsakarat/save-and-load-draft-automatically/webpack/runtime/hasOwnProperty shorthand","webpack://@tohsakarat/save-and-load-draft-automatically/webpack/runtime/make namespace object"],"sourcesContent":["import app from 'flarum/forum/app';\nimport  { extend, override } from 'flarum/common/extend';\nimport CommentPost from 'flarum/forum/components/CommentPost';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport DiscussionPageResolver from 'flarum/forum/resolvers/DiscussionPageResolver';\nimport PostStreamScrubber from 'flarum/forum/components/PostStreamScrubber';\napp.initializers.add('mypost', () => {\n//console.log(12345)\n  extend(CommentPost.prototype, 'oncreate', function () {\n    //console.log(this);\n    let clearPunctuation=(str)=>{;\n      let reg=new RegExp( /[\\x21-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7B-\\x7F]/)\n      return str.replace( reg ,'-').replaceAll(' ','-');\n  }\n\n  //console.log(this)\n // if(!this.element)return items\n \n  let inPageLink=Array.prototype.slice.call(this.element.querySelectorAll('a[target=\"_self\"]'))\n  \n     inPageLink.forEach((e)=>{\n      if(e.href.indexOf(window.location.href.split('/').splice(0,4).join('/'))!=-1)e.onclick=(w)=>{\n      \n      w.preventDefault();\n      \n     app.current.data.stream.goToNumber(e.href.split('/')[5].split('#')[0]).then(()=>{\n    \t\t  if(e.href.split('/')[5])setTimeout(()=>{\n    \t\t\t//console.log(a)\n    \t\t  window.location.hash  =  '#'+ e.href.split('#')[1];\n    \t\t  setTimeout(()=>{ m.redraw();},100)\n    \t\t},500)}\n    \t\t)\n      return false;\n      \n      }\n    \n    \n    })\n \n \n \n \n \n \n \n \n \n \n \n \n \n \n  let elements1=Array.prototype.slice.call(this.element.querySelectorAll('.Post-body :is(h1, h2, h3, h4, h5, h6)'))\n  \n  \n  elements1.forEach((e,i)=>{\n    let anchor=e\n    while(1){\n    anchor = anchor.parentNode\n    if(anchor.dataset.number)break\n    }\n    e.innerHTML='<span class=\"title-anchor\"></span>'+ '<span class=\"title-sub-anchor\">'+ e.innerHTML+'</span>'; \n   //e.id=\n    e.dataset.id=anchor.dataset.number+'-'+clearPunctuation(e.innerText)+'-'+(elements1.map(k=>clearPunctuation(k.innerText)).filter(b=>b==clearPunctuation(e.innerText)).length==1?'':i);;\n    e.className+=' title-has-anchor';\n    e.querySelector('.title-anchor').id = e.dataset.id;\n    e.querySelector('.title-sub-anchor').id = e.dataset.id;\n   \n  })\n  this.catalog={}\n  this.catalog.id=this.attrs.post.data.id\n  \n  app.current.data.stream.posts().find(u=>u.data.id== this.catalog.id).catalog=this.catalog\n  this.catalog.elements=Array.prototype.slice.call(this.element.querySelectorAll('.Post-body :is(h1, h2, h3, h4, h5, h6,.sub-anchor)'))\n  this.catalog.content=this.catalog.elements.map(\n      (e)=>{\n        \n        let isAnchor=Array(e.classList).map(e=>e.value).indexOf('sub-anchor')!=-1\n        let id=isAnchor? e.id : e.dataset.id\n       let link=     window.location.origin+'/d/'+this.attrs.post.data.relationships.discussion.data.id + '/'+this.attrs.post.data.attributes.number+'#'+id\n        let a=<p> <a\n        href={link}\n        target='_self'\n        data-number={this.attrs.post.data.attributes.number}\n        \n        data-isAnchor={isAnchor}\n        data-id={id}\n        data-tag={e.tagName}\n        onclick={(u)=>{  \n\n          u.preventDefault();\n           app.current.data.stream.goToNumber(a.dom.dataset.number).then(()=>{\n              setTimeout(()=>{\n                //console.log(a)\n              window.location.hash  =  '#'+ id;\n               setTimeout(()=>{ m.redraw();},100)\n            },250)}\n            )\n            return false;\n          }\n        }\n        >{e.innerText+'\\n'}</a></p>\n    \n       \n      \n       // a= document.createTextNode(a)\n       // console.log('#'+e.dataset.id)\n       \n        //this.element.querySelector('.Post-header').appendChild(a)\n        \n       //a=$(a)\n       \n        return a;\n        //console.log(a)\n       // console.log(items)\n      //  items.push(a)\n      //  console.log(a)\n        //this.content[0]\n      }\n      )\n      \n   //   app.catalog={\n    //    view:function(){\n   //       return <div class=\"catalogDIV\">{content}</div>\n   //     }\n      \n  //    }\n\n  //    app.catalog.content=this.catalog.content;\n\n  //console.log('啊吧啊吧')\n\n\n    // console.log(this)\n    \n     //console.log(CommentPost.prototype)\n\n\n\n     //return items; \n\n\n    }); \n\n\n    extend(PostStreamScrubber.prototype, 'view', function (vnode){\n      // if(app.current.data.stream.posts().filter((w)=>{return w.attributes.number==this.attrs.post.data.attributes.number})[0])app.current.data.stream.posts().filter((w)=>{return w.attributes.number==this.attrs.post.data.attributes.number})[0].catalog=this.catalog\n\n      \n        try{\n        vnode.children.push(<div class='catalog-top'>\n            {app.current.data.stream.posts().find(u=>u.data?.id==app.current.data.stream.posts()[Math.floor(app.current.data.stream.index-app.current.data.stream.visibleStart)-1>0?Math.floor(app.current.data.stream.index-app.current.data.stream.visibleStart)-1:0].data?.id)\n           .catalog?.content}\n\n        </div>)}catch (e){\n            console.log(e)\n        }\n        //console.log( app.current.data.stream.posts().find(u=>u.data.id==app.current.data.stream.posts()[Math.floor(app.current.data.stream.index-app.current.data.stream.visibleStart)].data.id).catalog?.content)\n           \n       return vnode\n \n \n       })\n       \n      // m.redraw()\n  \n      override(DiscussionPageResolver.prototype, 'onmatch', function (original, args, requestedPath, route){\n        \n      if (app.current.matches(DiscussionPage) && this.canonicalizeDiscussionSlug(args.id) === this.canonicalizeDiscussionSlug(m.route.param('id'))) {\n        // By default, the first post number of any discussion is 1\n       if(args.near!=m.route.param('near') || window.location.href.indexOf('#')==-1 )DiscussionPageResolver.scrollToPostNumber = args.near || 1;//在贴在路由不变情况下不要滚回开头\n\n      }\n     // console.log('original DicussionPageResolver')\n      //console.log(this.__proto__.__proto__.onmatch)\n      return this.__proto__.__proto__.onmatch.call(this, args, requestedPath, route);\n    })\n\n    override(DiscussionPageResolver.prototype, 'render', function (original, vnode){\n      if (DiscussionPageResolver.scrollToPostNumber !== null) {\n        const number = DiscussionPageResolver.scrollToPostNumber;\n        // Scroll after a timeout to avoid clashes with the render.\n        \n       if(DiscussionPageResolver.scrollToPostNumber!=m.route.param('near')|| window.location.href.indexOf('#')==-1 ) setTimeout(() => app.current.get('stream').goToNumber(number));//在贴在路由不变情况下不要滚回开头\n        \n  \n        DiscussionPageResolver.scrollToPostNumber = null;\n      }\n  \n      return this.__proto__.__proto__.render(vnode);\n    })\n\n\n    override(DiscussionPage.prototype, 'render', function (original,discussion){\n      app.history.push('discussion', discussion.title());\n      app.setTitle(discussion.title());\n      app.setTitleCount(0);\n      console.log('DiscussionPage-overide')\n      // When the API responds with a discussion, it will also include a number of\n      // posts. Some of these posts are included because they are on the first\n      // page of posts we want to display (determined by the `near` parameter) –\n      // others may be included because due to other relationships introduced by\n      // extensions. We need to distinguish the two so we don't end up displaying\n      // the wrong posts. We do so by filtering out the posts that don't have\n      // the 'discussion' relationship linked, then sorting and splicing.\n      let includedPosts = [];\n      if (discussion.payload && discussion.payload.included) {\n        const discussionId = discussion.id();\n  \n        includedPosts = discussion.payload.included\n          .filter(\n            (record) =>\n              record.type === 'posts' &&\n              record.relationships &&\n              record.relationships.discussion &&\n              !Array.isArray(record.relationships.discussion.data) &&\n              record.relationships.discussion.data.id === discussionId\n          )\n          // We can make this assertion because posts should be in the store,\n          // since they were in the discussion's payload.\n          .map((record) => app.store.getById('posts', record.id) )\n          .sort((a, b) => a.number() - b.number())\n          .slice(0, 20);\n      }\n  \n      // Set up the post stream for this discussion, along with the first page of\n      // posts we want to display. Tell the stream to scroll down and highlight\n      // the specific post that was routed to.\n      this.stream = new PostStreamState(discussion, includedPosts);\n      const rawNearParam = m.route.param('near');\n      const nearParam = rawNearParam === 'reply' ? 'reply' : parseInt(rawNearParam);\n    \n      this.stream.goToNumber(nearParam || (includedPosts[0]?.number() ?? 0), true).then(() => {\n        this.discussion = discussion;\n  \n        app.current.set('discussion', discussion);\n        app.current.set('stream', this.stream);\n      if(window.location.href.indexOf('#')!=-1 && window.location.href.split('#').length==2){\n      let hash=window.location.href.split('#')[1]\n      \n      setTimeout(()=>{\n      window.location.hash  =   '#'+hash;\n      },500)\n      setTimeout(()=>{\n      window.location.hash  =   '#'+hash;\n      },1000)\n      }\n      \n      \n      \n      });\n      \n      \n  \n    })\n\n\n    \n\n\n    window.updateCatalogTop=()=>{\n      m.redraw();\n    }\n\n        window.addEventListener('scroll', window.updateCatalogTop); \n\n   //this.catalog.children=app.current.data.stream?.posts()[app.current.data.stream.visible]\n   //return callback;\n\n   // document.querySelector(\"#content\").dataset.streamNear=this.near\n   // $('.item-scrubber>.Dropdown-menu.dropdown-menu')[0].append\n\n  \n})\n  \n  \n","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/CommentPost'];","module.exports = flarum.core.compat['forum/components/DiscussionPage'];","module.exports = flarum.core.compat['forum/components/PostStreamScrubber'];","module.exports = flarum.core.compat['forum/resolvers/DiscussionPageResolver'];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["app","extend","override","CommentPost","DiscussionPage","DiscussionPageResolver","PostStreamScrubber","initializers","add","prototype","clearPunctuation","str","reg","RegExp","replace","replaceAll","inPageLink","Array","slice","call","element","querySelectorAll","forEach","e","href","indexOf","window","location","split","splice","join","onclick","w","preventDefault","current","data","stream","goToNumber","then","setTimeout","hash","m","redraw","elements1","i","anchor","parentNode","dataset","number","innerHTML","id","innerText","map","k","filter","b","length","className","querySelector","catalog","attrs","post","posts","find","u","elements","content","isAnchor","classList","value","link","origin","relationships","discussion","attributes","a","tagName","dom","vnode","children","push","Math","floor","index","visibleStart","console","log","original","args","requestedPath","route","matches","canonicalizeDiscussionSlug","param","near","scrollToPostNumber","__proto__","onmatch","get","render","history","title","setTitle","setTitleCount","includedPosts","payload","included","discussionId","record","type","isArray","store","getById","sort","PostStreamState","rawNearParam","nearParam","parseInt","set","updateCatalogTop","addEventListener"],"sourceRoot":""}